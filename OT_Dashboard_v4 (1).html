<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Outcomes Tracking â€” Goal Setting</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #1a2a6c;
    --navy-dark: #111d52;
    --teal: #00c9c8;
    --teal-dark: #00a8a7;
    --white: #ffffff;
    --light: #f0f4ff;
    --mid: #d0daf5;
    --text: #1a2a6c;
    --muted: #6b7aab;
    --red: #e63946;
    --green: #2dc653;
    --orange: #f4a261;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Barlow', sans-serif;
    background: var(--light);
    color: var(--text);
    min-height: 100vh;
  }

  /* â”€â”€ HEADER â”€â”€ */
  .app-header {
    background: var(--navy);
    padding: 14px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.3);
  }
  .app-header .logo {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 22px;
    font-weight: 800;
    color: var(--white);
    letter-spacing: 1px;
  }
  .app-header .logo span { color: var(--teal); }
  .user-badge {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 20px;
    padding: 6px 14px;
    color: var(--white);
    font-size: 13px;
    font-weight: 600;
  }
  .user-badge span { color: var(--teal); }

  /* â”€â”€ SCREENS â”€â”€ */
  .screen { display: none; min-height: 100vh; }
  .screen.active { display: block; }

  /* â”€â”€ LOGIN SCREEN â”€â”€ */
  #screen-login {
    background: linear-gradient(135deg, var(--navy-dark) 0%, var(--navy) 60%, #1a4a8c 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    min-height: 100vh;
  }
  #screen-login.active { display: flex; }
  .login-logo {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 42px;
    font-weight: 800;
    color: var(--white);
    letter-spacing: 2px;
    text-align: center;
    margin-bottom: 4px;
  }
  .login-logo span { color: var(--teal); }
  .login-tagline {
    color: var(--mid);
    font-size: 14px;
    letter-spacing: 2px;
    text-transform: uppercase;
    text-align: center;
    margin-bottom: 40px;
  }
  .login-card {
    background: var(--white);
    border-radius: 16px;
    padding: 36px 32px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }
  .login-card h2 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 20px;
    font-weight: 700;
    color: var(--navy);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 20px;
    text-align: center;
  }
  .role-tabs {
    display: flex;
    background: var(--light);
    border-radius: 8px;
    padding: 4px;
    margin-bottom: 24px;
  }
  .role-tab {
    flex: 1;
    padding: 8px;
    text-align: center;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--muted);
  }
  .role-tab.active {
    background: var(--navy);
    color: var(--white);
  }

  /* â”€â”€ FORM ELEMENTS â”€â”€ */
  .form-group { margin-bottom: 16px; }
  .form-group label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--muted);
    margin-bottom: 6px;
  }
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 11px 14px;
    border: 2px solid var(--mid);
    border-radius: 8px;
    font-family: 'Barlow', sans-serif;
    font-size: 15px;
    color: var(--text);
    background: var(--white);
    transition: border-color 0.2s;
    outline: none;
  }
  .form-group input:focus, .form-group select:focus {
    border-color: var(--teal);
  }
  .form-group input[readonly] {
    background: var(--light);
    color: var(--navy);
    font-weight: 600;
  }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

  /* â”€â”€ BUTTONS â”€â”€ */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 24px;
    border-radius: 8px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    width: 100%;
  }
  .btn-primary {
    background: var(--teal);
    color: var(--navy);
  }
  .btn-primary:hover { background: var(--teal-dark); transform: translateY(-1px); }
  .btn-navy {
    background: var(--navy);
    color: var(--white);
  }
  .btn-navy:hover { background: var(--navy-dark); }
  .btn-outline {
    background: transparent;
    color: var(--navy);
    border: 2px solid var(--navy);
  }
  .btn-outline:hover { background: var(--navy); color: var(--white); }
  .btn-sm { padding: 8px 16px; font-size: 13px; width: auto; }
  .btn-danger { background: var(--red); color: white; }

  /* â”€â”€ STEP NAV â”€â”€ */
  .step-nav {
    background: var(--navy);
    padding: 12px 20px;
    display: flex;
    gap: 4px;
    overflow-x: auto;
  }
  .step-pill {
    flex-shrink: 0;
    padding: 7px 14px;
    border-radius: 20px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    color: rgba(255,255,255,0.5);
    border: 1px solid rgba(255,255,255,0.1);
  }
  .step-pill.active {
    background: var(--teal);
    color: var(--navy);
    border-color: var(--teal);
  }
  .step-pill.done {
    color: rgba(255,255,255,0.8);
    border-color: rgba(255,255,255,0.3);
  }

  /* â”€â”€ PAGE CONTENT â”€â”€ */
  .page-content {
    max-width: 800px;
    margin: 0 auto;
    padding: 24px 16px 60px;
  }
  .page-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 28px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--navy);
    margin-bottom: 4px;
  }
  .page-subtitle {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 24px;
  }

  /* â”€â”€ CARDS â”€â”€ */
  .card {
    background: var(--white);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
    box-shadow: 0 2px 8px rgba(26,42,108,0.08);
  }
  .card-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--navy);
    margin-bottom: 16px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--teal);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .card-title .badge {
    background: var(--navy);
    color: var(--white);
    font-size: 11px;
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: auto;
  }
  .card-title .badge-teal {
    background: var(--teal);
    color: var(--navy);
  }

  /* â”€â”€ FUNNEL TABLE â”€â”€ */
  .funnel-table { width: 100%; border-collapse: collapse; }
  .funnel-table th {
    background: var(--navy);
    color: var(--white);
    padding: 10px 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-align: left;
    text-transform: uppercase;
  }
  .funnel-table th:first-child { border-radius: 6px 0 0 0; }
  .funnel-table th:last-child { border-radius: 0 6px 0 0; }
  .funnel-table td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--mid);
    font-size: 14px;
  }
  .funnel-table tr:last-child td { border-bottom: none; }
  .funnel-table tr:nth-child(even) td { background: var(--light); }
  .funnel-table input {
    width: 80px;
    padding: 6px 8px;
    border: 1.5px solid var(--mid);
    border-radius: 6px;
    font-size: 14px;
    text-align: center;
    outline: none;
  }
  .funnel-table input:focus { border-color: var(--teal); }
  .funnel-table .gap-cell {
    font-weight: 700;
    font-size: 15px;
  }
  .gap-high { color: var(--red); }
  .gap-mid { color: var(--orange); }
  .gap-good { color: var(--green); }

  /* â”€â”€ HIGHLIGHT ROW â”€â”€ */
  .biggest-gap-row td { background: #fff3cd !important; }

  /* â”€â”€ METRIC BOXES â”€â”€ */
  .metric-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
  .metric-box {
    background: var(--navy);
    border-radius: 10px;
    padding: 14px;
    text-align: center;
    color: var(--white);
  }
  .metric-box .val {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 28px;
    font-weight: 800;
    color: var(--teal);
    line-height: 1;
  }
  .metric-box .lbl {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: rgba(255,255,255,0.6);
    margin-top: 4px;
  }

  /* â”€â”€ PACE BAR â”€â”€ */
  .pace-bar-wrap { margin: 8px 0; }
  .pace-bar-label { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 4px; }
  .pace-bar-track {
    height: 10px;
    background: var(--mid);
    border-radius: 10px;
    overflow: hidden;
  }
  .pace-bar-fill {
    height: 100%;
    border-radius: 10px;
    background: linear-gradient(90deg, var(--teal), #00a8a7);
    transition: width 0.5s ease;
  }

  /* â”€â”€ AUTO-FILL INDICATOR â”€â”€ */
  .auto-tag {
    font-size: 10px;
    background: var(--teal);
    color: var(--navy);
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    vertical-align: middle;
    margin-left: 6px;
  }

  /* â”€â”€ MANAGER DASHBOARD â”€â”€ */
  .manager-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
  .fundraiser-card {
    background: var(--white);
    border-radius: 10px;
    padding: 16px;
    box-shadow: 0 2px 8px rgba(26,42,108,0.1);
    border-left: 4px solid var(--teal);
    cursor: pointer;
    transition: transform 0.15s;
  }
  .fundraiser-card:hover { transform: translateY(-2px); }
  .fundraiser-card .name {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--navy);
    margin-bottom: 8px;
  }
  .fundraiser-card .stat { font-size: 13px; color: var(--muted); margin-bottom: 3px; }
  .fundraiser-card .stat strong { color: var(--text); }
  .pace-good { color: var(--green) !important; font-weight: 700 !important; }
  .pace-warn { color: var(--orange) !important; font-weight: 700 !important; }
  .pace-bad { color: var(--red) !important; font-weight: 700 !important; }

  /* â”€â”€ INFO BOX â”€â”€ */
  .info-box {
    background: linear-gradient(135deg, var(--navy), #1a4a8c);
    border-radius: 10px;
    padding: 16px 20px;
    color: var(--white);
    margin-bottom: 16px;
    font-size: 14px;
    line-height: 1.6;
  }
  .info-box strong { color: var(--teal); }

  /* â”€â”€ SECTION DIVIDER â”€â”€ */
  .divider {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    margin: 20px 0 12px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .divider::after { content: ''; flex: 1; height: 1px; background: var(--mid); }

  /* â”€â”€ GOALS SUMMARY â”€â”€ */
  .goal-summary {
    background: linear-gradient(135deg, var(--navy), #1a4a8c);
    border-radius: 12px;
    padding: 20px;
    color: var(--white);
    margin-bottom: 16px;
  }
  .goal-summary h3 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 18px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--teal);
    margin-bottom: 12px;
  }
  .goal-row { display: flex; justify-content: space-between; font-size: 14px; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
  .goal-row:last-child { border-bottom: none; }
  .goal-row .val { font-weight: 700; color: var(--teal); }

  /* â”€â”€ ALERT â”€â”€ */
  .alert { border-radius: 8px; padding: 12px 16px; font-size: 14px; margin-bottom: 16px; }
  .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
  .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
  .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }

  /* â”€â”€ BOTTOM NAV â”€â”€ */
  .bottom-nav {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--white);
    border-top: 2px solid var(--mid);
    padding: 12px 16px;
    display: flex;
    gap: 10px;
    z-index: 50;
  }
  .bottom-nav .btn { margin: 0; }

  /* â”€â”€ MANAGER SETTINGS â”€â”€ */
  .settings-table { width: 100%; border-collapse: collapse; }
  .settings-table th {
    background: var(--navy);
    color: var(--white);
    padding: 9px 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-align: left;
  }
  .settings-table td { padding: 8px 12px; border-bottom: 1px solid var(--mid); }
  .settings-table tr:last-child td { border-bottom: none; }
  .settings-table input {
    width: 100%;
    padding: 7px 10px;
    border: 1.5px solid var(--mid);
    border-radius: 6px;
    font-size: 14px;
    outline: none;
  }
  .settings-table input:focus { border-color: var(--teal); }

  /* â”€â”€ TABS â”€â”€ */
  .tab-nav { display: flex; gap: 4px; margin-bottom: 20px; border-bottom: 2px solid var(--mid); }
  .tab-btn {
    padding: 10px 18px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--muted);
    cursor: pointer;
    border: none;
    background: none;
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s;
  }
  .tab-btn.active { color: var(--navy); border-bottom-color: var(--teal); }
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media (max-width: 480px) {
    .form-row, .form-row-3 { grid-template-columns: 1fr; }
    .metric-grid { grid-template-columns: 1fr 1fr; }
    .page-content { padding: 16px 12px 80px; }
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-login" class="screen active">
  <div class="login-logo">OUTCOMES<span>TRACKING</span></div>
  <div class="login-tagline">What you can track, you can improve</div>

  <div class="login-card">
    <h2>Sign In</h2>
    <div class="role-tabs">
      <div class="role-tab active" onclick="switchRole('fundraiser')">Fundraiser</div>
      <div class="role-tab" onclick="switchRole('manager')">Manager</div>
    </div>

    <div id="login-fundraiser">
      <div class="form-group">
        <label>Your Name</label>
        <input type="text" id="fr-name" placeholder="e.g. Alex Smith">
      </div>
      <div class="form-group">
        <label>Team Code</label>
        <input type="text" id="fr-team" placeholder="e.g. TEAM01" style="text-transform:uppercase">
      </div>
      <div class="form-group">
        <label>Week Starting</label>
        <input type="date" id="fr-week">
      </div>
      <button class="btn btn-primary" onclick="loginFundraiser()">START GOAL SETTING â†’</button>
    </div>

    <div id="login-manager" style="display:none">
      <div class="form-group">
        <label>Manager Name</label>
        <input type="text" id="mg-name" placeholder="e.g. Jordan Lee">
      </div>
      <div class="form-group">
        <label>Team Code</label>
        <input type="text" id="mg-team" placeholder="e.g. TEAM01" style="text-transform:uppercase">
      </div>
      <div class="form-group">
        <label>Manager PIN</label>
        <input type="password" id="mg-pin" placeholder="4-digit PIN">
      </div>
      <button class="btn btn-navy" onclick="loginManager()">OPEN MANAGER PORTAL â†’</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FUNDRAISER APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-fundraiser" class="screen">
  <div class="app-header">
    <div class="logo">OT <span>GOALS</span></div>
    <div class="user-badge" id="fr-badge">Week of <span id="badge-week"></span></div>
  </div>

  <div class="step-nav" id="step-nav">
    <div class="step-pill active" data-step="1" onclick="goStep(1)">1. Review Data</div>
    <div class="step-pill" data-step="2" onclick="goStep(2)">2. Set Goals</div>
    <div class="step-pill" data-step="3" onclick="goStep(3)">3. Mid-Week</div>
    <div class="step-pill" data-step="4" onclick="goStep(4)">4. Weekly Review</div>
  </div>

  <!-- â”€â”€ STEP 1: REVIEW DATA â”€â”€ -->
  <div id="step-1" class="page-content">
    <div class="page-title">Review Your Data</div>
    <div class="page-subtitle">Enter your recent stats â€” this tells us where to focus</div>

    <div class="info-box">
      <strong>Input = Output.</strong> A true dataset is the best dataset. Fill in your recent numbers honestly â€” the more accurate this is, the better your goals will be.
    </div>

    <!-- Daily Averages -->
    <div class="card">
      <div class="card-title">ğŸ“Š Daily Averages (Recent Data)</div>
      <div class="form-row">
        <div class="form-group">
          <label>Avg Total Interactions / Day</label>
          <input type="number" id="avg-interactions" placeholder="e.g. 45" oninput="updateFunnelCalcs()">
        </div>
        <div class="form-group">
          <label>Avg Sign-ups / Day</label>
          <input type="number" id="avg-signups" placeholder="e.g. 2.5" step="0.1" oninput="updateFunnelCalcs()">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Avg Seen Per Day <span class="auto-tag">Track</span></label>
          <input type="number" id="avg-seen" placeholder="e.g. 38" oninput="updateFunnelCalcs()">
        </div>
        <div class="form-group">
          <label>Target Seen Per Day <span class="auto-tag">Goal</span></label>
          <input type="number" id="target-seen" placeholder="e.g. 50" oninput="updateFunnelCalcs()">
        </div>
      </div>
    </div>

    <!-- Funnel Conversion Table -->
    <div class="card">
      <div class="card-title">ğŸ”¢ Funnel Conversions <span class="badge badge-teal" id="auto-gap-badge" style="display:none">AUTO-FILLED âœ“</span></div>
      <p style="font-size:13px;color:var(--muted);margin-bottom:12px;">Enter your current % for each step. Your biggest gap will be auto-detected.</p>
      <div style="overflow-x:auto">
        <table class="funnel-table" id="funnel-table">
          <thead>
            <tr>
              <th>Funnel Step</th>
              <th>Your %</th>
              <th>Standard</th>
              <th>Gap</th>
            </tr>
          </thead>
          <tbody id="funnel-body">
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Biggest Gap (auto-filled) -->
    <div class="card">
      <div class="card-title">ğŸ¯ My Biggest Gap <span class="auto-tag">AUTO</span></div>
      <div class="form-row">
        <div class="form-group">
          <label>Focus Area</label>
          <select id="biggest-gap-select" onchange="syncGapToGoals()">
            <option value="">â€” Auto detecting... â€”</option>
          </select>
        </div>
        <div class="form-group">
          <label>Current %</label>
          <input type="number" id="gap-current-pct" readonly placeholder="Auto-fills">
        </div>
        <div class="form-group">
          <label>Company Standard</label>
          <input type="number" id="gap-standard-pct" readonly placeholder="Auto-fills">
        </div>
      </div>
    </div>

    <div class="bottom-nav">
      <button class="btn btn-primary" onclick="goStep(2)">NEXT: SET GOALS â†’</button>
    </div>
  </div>

  <!-- â”€â”€ STEP 2: SET GOALS â”€â”€ -->
  <div id="step-2" class="page-content" style="display:none">
    <div class="page-title">Set Your Goals</div>
    <div class="page-subtitle">Productivity Goals + Growth Goals for this week</div>

    <!-- Productivity Goals -->
    <div class="card">
      <div class="card-title">âš¡ Productivity Goals</div>
      <div class="form-row">
        <div class="form-group">
          <label>Daily Interaction Target</label>
          <input type="number" id="goal-interactions" placeholder="e.g. 50" oninput="calcProjected()">
        </div>
        <div class="form-group">
          <label>Days Working This Week</label>
          <input type="number" id="goal-days" placeholder="e.g. 5" value="5" oninput="calcProjected()">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>LOA Target (1 in X)</label>
          <input type="number" id="goal-loa" placeholder="e.g. 18" oninput="calcProjected()">
        </div>
        <div class="form-group">
          <label>Projected Sign-ups <span class="auto-tag">CALC</span></label>
          <input type="number" id="goal-projected" readonly placeholder="Auto-calculated">
        </div>
      </div>
    </div>

    <!-- Growth Goals -->
    <div class="card">
      <div class="card-title">ğŸ“ˆ Growth Goal â€” Focus Area <span class="auto-tag">AUTO</span></div>
      <div class="form-row">
        <div class="form-group">
          <label>Focus Step</label>
          <input type="text" id="growth-focus-step" readonly placeholder="Auto-fills from Step 1">
        </div>
        <div class="form-group">
          <label>Current %</label>
          <input type="number" id="growth-current-pct" readonly placeholder="Auto-fills">
        </div>
      </div>
      <div class="form-group">
        <label>My Action This Week</label>
        <input type="text" id="growth-action" placeholder="e.g. Practice my pitch opening 10x per day">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Target % by End of Week</label>
          <input type="number" id="growth-target-pct" placeholder="e.g. 45">
        </div>
        <div class="form-group">
          <label>Personal Goal (optional)</label>
          <input type="text" id="growth-personal" placeholder="e.g. Earn $800 this week">
        </div>
      </div>
    </div>

    <!-- Summary -->
    <div id="goals-summary-box" class="goal-summary" style="display:none">
      <h3>ğŸ“‹ Weekly Goal Summary</h3>
      <div id="goals-summary-content"></div>
    </div>

    <div class="bottom-nav">
      <button class="btn btn-outline btn-sm" onclick="goStep(1)" style="width:auto;flex-shrink:0">â† Back</button>
      <button class="btn btn-primary" onclick="saveGoals()">SAVE & SUBMIT GOALS â†’</button>
    </div>
  </div>

  <!-- â”€â”€ STEP 3: MID-WEEK â”€â”€ -->
  <div id="step-3" class="page-content" style="display:none">
    <div class="page-title">Mid-Week Check-In</div>
    <div class="page-subtitle">How are you tracking? Honest data only.</div>

    <div class="card">
      <div class="card-title">ğŸ“… Mid-Week Numbers</div>
      <div class="form-row">
        <div class="form-group">
          <label>Days Worked So Far</label>
          <input type="number" id="mw-days" placeholder="e.g. 3" oninput="calcMidweekPace()">
        </div>
        <div class="form-group">
          <label>Total Interactions So Far</label>
          <input type="number" id="mw-interactions" placeholder="e.g. 135" oninput="calcMidweekPace()">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Sign-ups So Far</label>
          <input type="number" id="mw-signups" placeholder="e.g. 7" oninput="calcMidweekPace()">
        </div>
        <div class="form-group">
          <label>Current LOA (1 in X)</label>
          <input type="number" id="mw-loa" placeholder="e.g. 19" oninput="calcMidweekPace()">
        </div>
      </div>
    </div>

    <div class="card" id="mw-pace-card" style="display:none">
      <div class="card-title">ğŸ“Š Mid-Week Pace</div>
      <div class="metric-grid">
        <div class="metric-box">
          <div class="val" id="mw-we-pace">â€“</div>
          <div class="lbl">WE Pace</div>
        </div>
        <div class="metric-box">
          <div class="val" id="mw-sales-pace">â€“</div>
          <div class="lbl">Sales Pace</div>
        </div>
        <div class="metric-box">
          <div class="val" id="mw-projected-total">â€“</div>
          <div class="lbl">Projected Signups</div>
        </div>
      </div>
      <div class="pace-bar-wrap">
        <div class="pace-bar-label"><span>Work Ethic</span><span id="mw-we-label">0%</span></div>
        <div class="pace-bar-track"><div class="pace-bar-fill" id="mw-we-bar" style="width:0%"></div></div>
      </div>
      <div class="pace-bar-wrap" style="margin-top:8px">
        <div class="pace-bar-label"><span>Sales Pace</span><span id="mw-sales-label">0%</span></div>
        <div class="pace-bar-track"><div class="pace-bar-fill" id="mw-sales-bar" style="width:0%"></div></div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ’¬ Mid-Week Notes</div>
      <div class="form-group">
        <label>What's going well?</label>
        <textarea id="mw-going-well" rows="2" placeholder="e.g. Opening pitch is landing much better"></textarea>
      </div>
      <div class="form-group">
        <label>What needs focus?</label>
        <textarea id="mw-needs-focus" rows="2" placeholder="e.g. Need to improve close rate"></textarea>
      </div>
    </div>

    <div class="bottom-nav">
      <button class="btn btn-outline btn-sm" onclick="goStep(2)" style="width:auto;flex-shrink:0">â† Back</button>
      <button class="btn btn-primary" onclick="saveMidweek()">SUBMIT MID-WEEK â†’</button>
    </div>
  </div>

  <!-- â”€â”€ STEP 4: WEEKLY REVIEW â”€â”€ -->
  <div id="step-4" class="page-content" style="display:none">
    <div class="page-title">Weekly Review</div>
    <div class="page-subtitle">How did the week go? Lock in your data.</div>

    <div class="card">
      <div class="card-title">ğŸ“Š Final Numbers</div>
      <div class="form-row">
        <div class="form-group">
          <label>Total Interactions</label>
          <input type="number" id="wr-interactions" placeholder="e.g. 230" oninput="calcWeeklyReview()">
        </div>
        <div class="form-group">
          <label>Total Sign-ups <span class="auto-tag" id="wr-signups-tag" style="display:none">AUTO</span></label>
          <input type="number" id="wr-signups" placeholder="e.g. 12" oninput="calcWeeklyReview()">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>LOA Actual (1 in X) <span class="auto-tag" id="wr-loa-tag" style="display:none">AUTO</span></label>
          <input type="number" id="wr-loa" placeholder="Auto-fills from mid-week" oninput="calcWeeklyReview()">
        </div>
        <div class="form-group">
          <label>Days Worked</label>
          <input type="number" id="wr-days" placeholder="e.g. 5" value="5" oninput="calcWeeklyReview()">
        </div>
      </div>
    </div>

    <div class="card" id="wr-results-card" style="display:none">
      <div class="card-title">ğŸ Week Results vs Goals</div>
      <div id="wr-results-content"></div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ“ Reflection</div>
      <div class="form-group">
        <label>What worked this week?</label>
        <textarea id="wr-worked" rows="2" placeholder="e.g. Consistency in interactions paid off..."></textarea>
      </div>
      <div class="form-group">
        <label>What will I do differently next week?</label>
        <textarea id="wr-different" rows="2" placeholder="e.g. Focus on getting past the first objection..."></textarea>
      </div>
    </div>

    <div class="bottom-nav">
      <button class="btn btn-outline btn-sm" onclick="goStep(3)" style="width:auto;flex-shrink:0">â† Back</button>
      <button class="btn btn-primary" onclick="saveWeeklyReview()">SUBMIT WEEKLY REVIEW âœ“</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MANAGER PORTAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-manager" class="screen">
  <div class="app-header">
    <div class="logo">OT <span>MANAGER</span></div>
    <div style="display:flex;gap:10px;align-items:center">
      <div class="user-badge">Team: <span id="mg-badge-team"></span></div>
      <button class="btn btn-sm btn-outline" onclick="logout()" style="color:white;border-color:rgba(255,255,255,0.4);font-size:12px;padding:6px 12px">LOGOUT</button>
    </div>
  </div>

  <div class="page-content">
    <div class="tab-nav">
      <button class="tab-btn active" onclick="mgTab('dashboard')">Dashboard</button>
      <button class="tab-btn" onclick="mgTab('settings')">Team Settings</button>
    </div>

    <!-- DASHBOARD TAB -->
    <div id="tab-dashboard" class="tab-panel active">
      <div class="page-title">Team Dashboard</div>
      <div class="page-subtitle" id="mg-week-label">Current Week</div>

      <div class="metric-grid" style="margin-bottom:20px">
        <div class="metric-box">
          <div class="val" id="mg-total-fundraisers">0</div>
          <div class="lbl">Fundraisers</div>
        </div>
        <div class="metric-box">
          <div class="val" id="mg-avg-we-pace">â€“</div>
          <div class="lbl">Avg WE Pace</div>
        </div>
        <div class="metric-box">
          <div class="val" id="mg-avg-sales-pace">â€“</div>
          <div class="lbl">Avg Sales Pace</div>
        </div>
      </div>

      <div class="card-title" style="margin-bottom:12px">ğŸ‘¥ Fundraiser Overview</div>
      <div class="manager-grid" id="manager-grid">
        <div class="alert alert-info">No data submitted yet for this week.</div>
      </div>
    </div>

    <!-- SETTINGS TAB -->
    <div id="tab-settings" class="tab-panel">
      <div class="page-title">Team Settings</div>
      <div class="page-subtitle">Customise funnel step names and standards for your team</div>

      <div class="alert alert-info" style="margin-bottom:16px">
        These settings flow through to your fundraisers' goal setting sheets. Any changes take effect next time someone logs in.
      </div>

      <div class="card">
        <div class="card-title">ğŸ”§ Funnel Step Names & Standards</div>
        <table class="settings-table" id="settings-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Step Name</th>
              <th>Standard % (Min)</th>
              <th>Standard % (Max)</th>
            </tr>
          </thead>
          <tbody id="settings-body">
            <!-- Populated by JS -->
          </tbody>
        </table>
        <div style="margin-top:16px">
          <button class="btn btn-primary btn-sm" onclick="saveSettings()">SAVE SETTINGS âœ“</button>
        </div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ”‘ Manager PIN</div>
        <div class="form-row">
          <div class="form-group">
            <label>New PIN (4 digits)</label>
            <input type="password" id="new-pin" placeholder="0000" maxlength="4">
          </div>
          <div class="form-group">
            <label>Confirm PIN</label>
            <input type="password" id="confirm-pin" placeholder="0000" maxlength="4">
          </div>
        </div>
        <button class="btn btn-navy btn-sm" onclick="savePIN()">UPDATE PIN</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state = {
  role: null,
  name: '',
  team: '',
  weekStart: '',
  currentStep: 1,
  goals: {},
  midweek: {},
  funnelData: [],
  biggestGap: null,
  settings: null  // team settings from manager
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEFAULT FUNNEL STEPS (overridden by manager settings)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_STEPS = [
  { name: 'Approached â†’ Stopped',   standardMin: 60, standardMax: 80 },
  { name: 'Stopped â†’ Pitched',      standardMin: 70, standardMax: 85 },
  { name: 'Pitched â†’ Interested',   standardMin: 30, standardMax: 50 },
  { name: 'Interested â†’ Qualified', standardMin: 60, standardMax: 80 },
  { name: 'Qualified â†’ Sign-up',    standardMin: 40, standardMax: 60 },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STORAGE HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function storageKey(team, type) {
  return `ot_${team.toUpperCase()}_${type}`;
}

function saveToStorage(key, data) {
  try { localStorage.setItem(key, JSON.stringify(data)); } catch(e) {}
}

function loadFromStorage(key) {
  try {
    const d = localStorage.getItem(key);
    return d ? JSON.parse(d) : null;
  } catch(e) { return null; }
}

function getTeamSettings(team) {
  const saved = loadFromStorage(storageKey(team, 'settings'));
  return saved || { steps: DEFAULT_STEPS, pin: '1234' };
}

function saveTeamSettings(team, settings) {
  saveToStorage(storageKey(team, 'settings'), settings);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchRole(role) {
  document.querySelectorAll('.role-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('login-fundraiser').style.display = role === 'fundraiser' ? 'block' : 'none';
  document.getElementById('login-manager').style.display = role === 'manager' ? 'block' : 'none';
}

function loginFundraiser() {
  const name = document.getElementById('fr-name').value.trim();
  const team = document.getElementById('fr-team').value.trim().toUpperCase();
  const week = document.getElementById('fr-week').value;

  if (!name || !team || !week) {
    alert('Please fill in your name, team code and week starting date.');
    return;
  }

  state.role = 'fundraiser';
  state.name = name;
  state.team = team;
  state.weekStart = week;

  // Load team settings (for funnel steps)
  state.settings = getTeamSettings(team);

  document.getElementById('badge-week').textContent = formatDate(week);
  document.getElementById('fr-badge').innerHTML = `${name} &nbsp;|&nbsp; Week of <span>${formatDate(week)}</span>`;

  buildFunnelTable();

  showScreen('screen-fundraiser');
  goStep(1);
}

function loginManager() {
  const name = document.getElementById('mg-name').value.trim();
  const team = document.getElementById('mg-team').value.trim().toUpperCase();
  const pin = document.getElementById('mg-pin').value;

  if (!name || !team || !pin) {
    alert('Please fill in all fields.');
    return;
  }

  const settings = getTeamSettings(team);
  if (pin !== settings.pin) {
    alert('Incorrect PIN. Please try again.');
    return;
  }

  state.role = 'manager';
  state.name = name;
  state.team = team;
  state.settings = settings;

  document.getElementById('mg-badge-team').textContent = team;

  buildSettingsTable();
  loadManagerDashboard();

  showScreen('screen-manager');
}

function logout() {
  showScreen('screen-login');
  state = { role: null, name: '', team: '', weekStart: '', currentStep: 1, goals: {}, midweek: {}, funnelData: [], biggestGap: null, settings: null };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCREEN & STEP NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  const el = document.getElementById(id);
  el.classList.add('active');
  if (id === 'screen-login') el.style.display = 'flex';
}

function goStep(n) {
  // Hide all steps
  for (let i = 1; i <= 4; i++) {
    const el = document.getElementById(`step-${i}`);
    if (el) el.style.display = i === n ? 'block' : 'none';
  }

  // Update pills
  document.querySelectorAll('.step-pill').forEach(p => {
    const s = parseInt(p.dataset.step);
    p.classList.remove('active', 'done');
    if (s === n) p.classList.add('active');
    else if (s < n) p.classList.add('done');
  });

  state.currentStep = n;

  // Auto-fill when entering steps
  if (n === 2) populateGoalsFromStep1();
  if (n === 4) populateWeeklyReviewFromMidweek();

  window.scrollTo(0, 0);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STEP 1: FUNNEL TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildFunnelTable() {
  const steps = state.settings.steps;
  const tbody = document.getElementById('funnel-body');
  tbody.innerHTML = '';

  // Populate biggest gap dropdown
  const sel = document.getElementById('biggest-gap-select');
  sel.innerHTML = '<option value="">â€” Detecting... â€”</option>';

  steps.forEach((step, i) => {
    const tr = document.createElement('tr');
    tr.id = `funnel-row-${i}`;
    tr.innerHTML = `
      <td style="font-weight:600;font-size:13px">${step.name}</td>
      <td><input type="number" id="funnel-my-${i}" placeholder="%" min="0" max="100" oninput="updateFunnelCalcs()"></td>
      <td style="color:var(--muted);font-size:13px">${step.standardMin}â€“${step.standardMax}%</td>
      <td class="gap-cell" id="funnel-gap-${i}">â€”</td>
    `;
    tbody.appendChild(tr);

    // Add to dropdown
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = step.name;
    sel.appendChild(opt);
  });
}

function updateFunnelCalcs() {
  const steps = state.settings.steps;
  let worstGapIndex = -1;
  let worstGapAmount = -Infinity;

  steps.forEach((step, i) => {
    const input = document.getElementById(`funnel-my-${i}`);
    const myPct = parseFloat(input.value);
    const cell = document.getElementById(`funnel-gap-${i}`);
    const row = document.getElementById(`funnel-row-${i}`);

    row.classList.remove('biggest-gap-row');

    if (!isNaN(myPct)) {
      const midStandard = (step.standardMin + step.standardMax) / 2;
      const gap = midStandard - myPct;
      const gapPct = Math.round(gap);

      cell.textContent = gapPct > 0 ? `â–¼ ${gapPct}%` : gapPct < 0 ? `â–² ${Math.abs(gapPct)}%` : 'âœ“ On track';
      cell.className = 'gap-cell ' + (gapPct > 15 ? 'gap-high' : gapPct > 0 ? 'gap-mid' : 'gap-good');

      if (gapPct > worstGapAmount) {
        worstGapAmount = gapPct;
        worstGapIndex = i;
      }
    } else {
      cell.textContent = 'â€”';
      cell.className = 'gap-cell';
    }
  });

  // Auto-fill biggest gap
  if (worstGapIndex >= 0) {
    const step = steps[worstGapIndex];
    const myVal = parseFloat(document.getElementById(`funnel-my-${worstGapIndex}`).value);

    document.getElementById('biggest-gap-select').value = worstGapIndex;
    document.getElementById('gap-current-pct').value = myVal;
    document.getElementById('gap-standard-pct').value = Math.round((step.standardMin + step.standardMax) / 2);
    document.getElementById('auto-gap-badge').style.display = 'inline';

    // Highlight row
    document.getElementById(`funnel-row-${worstGapIndex}`).classList.add('biggest-gap-row');

    state.biggestGap = {
      index: worstGapIndex,
      name: step.name,
      currentPct: myVal,
      standardPct: Math.round((step.standardMin + step.standardMax) / 2)
    };

    syncGapToGoals();
  }

  // Store funnel data
  state.funnelData = steps.map((s, i) => ({
    name: s.name,
    myPct: parseFloat(document.getElementById(`funnel-my-${i}`).value) || null
  }));
}

function syncGapToGoals() {
  const idx = parseInt(document.getElementById('biggest-gap-select').value);
  if (isNaN(idx)) return;
  const steps = state.settings.steps;
  const step = steps[idx];
  const myPct = parseFloat(document.getElementById(`funnel-my-${idx}`).value) || null;

  document.getElementById('gap-current-pct').value = myPct || '';
  document.getElementById('gap-standard-pct').value = Math.round((step.standardMin + step.standardMax) / 2);

  state.biggestGap = {
    index: idx,
    name: step.name,
    currentPct: myPct,
    standardPct: Math.round((step.standardMin + step.standardMax) / 2)
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STEP 2: SET GOALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function populateGoalsFromStep1() {
  if (state.biggestGap) {
    document.getElementById('growth-focus-step').value = state.biggestGap.name;
    document.getElementById('growth-current-pct').value = state.biggestGap.currentPct || '';
  }
  calcProjected();
  updateGoalsSummary();
}

function calcProjected() {
  const interactions = parseFloat(document.getElementById('goal-interactions').value) || 0;
  const days = parseFloat(document.getElementById('goal-days').value) || 5;
  const loa = parseFloat(document.getElementById('goal-loa').value) || 0;

  if (interactions > 0 && loa > 0) {
    const totalInteractions = interactions * days;
    const projected = Math.round(totalInteractions / loa * 10) / 10;
    document.getElementById('goal-projected').value = projected;
  } else {
    document.getElementById('goal-projected').value = '';
  }

  updateGoalsSummary();
}

function updateGoalsSummary() {
  const interactions = document.getElementById('goal-interactions').value;
  const days = document.getElementById('goal-days').value;
  const loa = document.getElementById('goal-loa').value;
  const projected = document.getElementById('goal-projected').value;
  const focusStep = document.getElementById('growth-focus-step').value;
  const action = document.getElementById('growth-action').value;
  const targetPct = document.getElementById('growth-target-pct').value;

  if (!interactions && !loa) return;

  const box = document.getElementById('goals-summary-box');
  const content = document.getElementById('goals-summary-content');
  box.style.display = 'block';

  let html = '';
  if (interactions) html += `<div class="goal-row"><span>Daily Interaction Target</span><span class="val">${interactions} / day</span></div>`;
  if (days) html += `<div class="goal-row"><span>Days Working</span><span class="val">${days} days</span></div>`;
  if (loa) html += `<div class="goal-row"><span>LOA Target</span><span class="val">1 in ${loa}</span></div>`;
  if (projected) html += `<div class="goal-row"><span>Projected Sign-ups</span><span class="val">${projected} sign-ups</span></div>`;
  if (focusStep) html += `<div class="goal-row"><span>Focus Area</span><span class="val">${focusStep}</span></div>`;
  if (action) html += `<div class="goal-row"><span>My Action</span><span class="val">${action}</span></div>`;
  if (targetPct) html += `<div class="goal-row"><span>Target %</span><span class="val">${targetPct}%</span></div>`;

  content.innerHTML = html;
}

function saveGoals() {
  const goals = {
    interactions: parseFloat(document.getElementById('goal-interactions').value) || 0,
    days: parseFloat(document.getElementById('goal-days').value) || 5,
    loa: parseFloat(document.getElementById('goal-loa').value) || 0,
    projected: parseFloat(document.getElementById('goal-projected').value) || 0,
    focusStep: document.getElementById('growth-focus-step').value,
    currentPct: parseFloat(document.getElementById('growth-current-pct').value) || 0,
    action: document.getElementById('growth-action').value,
    targetPct: parseFloat(document.getElementById('growth-target-pct').value) || 0,
    personal: document.getElementById('growth-personal').value
  };

  state.goals = goals;

  // Save to team storage
  const key = storageKey(state.team, `goals_${state.name}_${state.weekStart}`);
  saveToStorage(key, {
    name: state.name,
    team: state.team,
    weekStart: state.weekStart,
    goals,
    funnelData: state.funnelData,
    avgInteractions: parseFloat(document.getElementById('avg-interactions').value) || 0,
    avgSignups: parseFloat(document.getElementById('avg-signups').value) || 0,
    avgSeen: parseFloat(document.getElementById('avg-seen').value) || 0,
    targetSeen: parseFloat(document.getElementById('target-seen').value) || 0,
    timestamp: new Date().toISOString()
  });

  alert('âœ… Goals saved! Head to mid-week check-in on day 3.');
  goStep(3);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STEP 3: MID-WEEK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcMidweekPace() {
  const daysDone = parseFloat(document.getElementById('mw-days').value) || 0;
  const interactions = parseFloat(document.getElementById('mw-interactions').value) || 0;
  const signups = parseFloat(document.getElementById('mw-signups').value) || 0;

  const goalInteractions = state.goals.interactions || 0;
  const goalDays = state.goals.days || 5;
  const goalProjected = state.goals.projected || 0;

  if (!daysDone || !goalInteractions) return;

  const card = document.getElementById('mw-pace-card');
  card.style.display = 'block';

  // WE Pace: actual interactions vs expected interactions by this point
  const expectedInteractionsSoFar = goalInteractions * daysDone;
  const wePace = expectedInteractionsSoFar > 0 ? Math.round((interactions / expectedInteractionsSoFar) * 100) : 0;

  // Sales Pace: project end-of-week signups vs goal
  const projectedFinalSignups = daysDone > 0 ? Math.round((signups / daysDone) * goalDays * 10) / 10 : 0;
  const salesPace = goalProjected > 0 ? Math.round((projectedFinalSignups / goalProjected) * 100) : 0;

  document.getElementById('mw-we-pace').textContent = `${wePace}%`;
  document.getElementById('mw-sales-pace').textContent = `${salesPace}%`;
  document.getElementById('mw-projected-total').textContent = projectedFinalSignups;

  document.getElementById('mw-we-label').textContent = `${wePace}%`;
  document.getElementById('mw-sales-label').textContent = `${salesPace}%`;
  document.getElementById('mw-we-bar').style.width = `${Math.min(wePace, 100)}%`;
  document.getElementById('mw-sales-bar').style.width = `${Math.min(salesPace, 100)}%`;

  // Store for weekly review auto-fill
  state.midweek = {
    daysDone,
    interactions,
    signups,
    loa: parseFloat(document.getElementById('mw-loa').value) || null,
    wePace,
    salesPace,
    projectedFinalSignups
  };
}

function saveMidweek() {
  calcMidweekPace();
  const midweek = {
    ...state.midweek,
    goingWell: document.getElementById('mw-going-well').value,
    needsFocus: document.getElementById('mw-needs-focus').value,
    timestamp: new Date().toISOString()
  };

  state.midweek = midweek;

  // Save to team storage for manager
  const key = storageKey(state.team, `midweek_${state.name}_${state.weekStart}`);
  saveToStorage(key, {
    name: state.name,
    team: state.team,
    weekStart: state.weekStart,
    goals: state.goals,
    midweek,
    timestamp: new Date().toISOString()
  });

  alert('âœ… Mid-week check-in saved!');
  goStep(4);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STEP 4: WEEKLY REVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function populateWeeklyReviewFromMidweek() {
  if (state.midweek && state.midweek.loa) {
    document.getElementById('wr-loa').value = state.midweek.loa;
    document.getElementById('wr-loa-tag').style.display = 'inline';
  }
  if (state.midweek && state.midweek.projectedFinalSignups) {
    document.getElementById('wr-signups').value = state.midweek.projectedFinalSignups;
    document.getElementById('wr-signups-tag').style.display = 'inline';
  }
  calcWeeklyReview();
}

function calcWeeklyReview() {
  const interactions = parseFloat(document.getElementById('wr-interactions').value) || 0;
  const signups = parseFloat(document.getElementById('wr-signups').value) || 0;
  const loa = parseFloat(document.getElementById('wr-loa').value) || 0;
  const days = parseFloat(document.getElementById('wr-days').value) || 5;

  if (!interactions && !signups) return;

  const card = document.getElementById('wr-results-card');
  card.style.display = 'block';

  const goalInteractions = state.goals.interactions || 0;
  const goalDays = state.goals.days || 5;
  const goalProjected = state.goals.projected || 0;

  const totalGoalInteractions = goalInteractions * goalDays;
  const wePct = totalGoalInteractions > 0 ? Math.round((interactions / totalGoalInteractions) * 100) : 0;
  const salesPct = goalProjected > 0 ? Math.round((signups / goalProjected) * 100) : 0;
  const actualLoa = interactions > 0 && signups > 0 ? Math.round(interactions / signups) : 0;

  const content = document.getElementById('wr-results-content');
  content.innerHTML = `
    <div class="metric-grid">
      <div class="metric-box">
        <div class="val" style="color:${wePct >= 90 ? 'var(--green)' : wePct >= 70 ? 'var(--orange)' : 'var(--red)'}">${wePct}%</div>
        <div class="lbl">WE Goal</div>
      </div>
      <div class="metric-box">
        <div class="val" style="color:${salesPct >= 90 ? 'var(--green)' : salesPct >= 70 ? 'var(--orange)' : 'var(--red)'}">${salesPct}%</div>
        <div class="lbl">Sales Goal</div>
      </div>
      <div class="metric-box">
        <div class="val">${actualLoa > 0 ? '1 in ' + actualLoa : 'â€“'}</div>
        <div class="lbl">Actual LOA</div>
      </div>
    </div>
    <div style="margin-top:12px">
      <div class="goal-row" style="color:white;border-color:rgba(255,255,255,0.15)"><span>Total Interactions</span><span class="val">${interactions} <small style="font-size:12px;opacity:0.6">(goal: ${totalGoalInteractions})</small></span></div>
      <div class="goal-row" style="color:white;border-color:rgba(255,255,255,0.15)"><span>Total Sign-ups</span><span class="val">${signups} <small style="font-size:12px;opacity:0.6">(goal: ${goalProjected})</small></span></div>
      <div class="goal-row" style="color:white;border-color:rgba(255,255,255,0.15)"><span>Days Worked</span><span class="val">${days}</span></div>
    </div>
  `;
}

function saveWeeklyReview() {
  const review = {
    interactions: parseFloat(document.getElementById('wr-interactions').value) || 0,
    signups: parseFloat(document.getElementById('wr-signups').value) || 0,
    loa: parseFloat(document.getElementById('wr-loa').value) || 0,
    days: parseFloat(document.getElementById('wr-days').value) || 5,
    worked: document.getElementById('wr-worked').value,
    different: document.getElementById('wr-different').value,
    timestamp: new Date().toISOString()
  };

  const key = storageKey(state.team, `weekly_${state.name}_${state.weekStart}`);
  saveToStorage(key, {
    name: state.name,
    team: state.team,
    weekStart: state.weekStart,
    goals: state.goals,
    midweek: state.midweek,
    review,
    timestamp: new Date().toISOString()
  });

  alert('ğŸ‰ Weekly review submitted! Great work this week.');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MANAGER: SETTINGS TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSettingsTable() {
  const steps = state.settings.steps;
  const tbody = document.getElementById('settings-body');
  tbody.innerHTML = '';

  steps.forEach((step, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="color:var(--muted);font-weight:700">${i + 1}</td>
      <td><input type="text" id="set-name-${i}" value="${step.name}"></td>
      <td><input type="number" id="set-min-${i}" value="${step.standardMin}" style="width:80px"></td>
      <td><input type="number" id="set-max-${i}" value="${step.standardMax}" style="width:80px"></td>
    `;
    tbody.appendChild(tr);
  });
}

function saveSettings() {
  const steps = state.settings.steps.map((s, i) => ({
    name: document.getElementById(`set-name-${i}`).value || s.name,
    standardMin: parseFloat(document.getElementById(`set-min-${i}`).value) || s.standardMin,
    standardMax: parseFloat(document.getElementById(`set-max-${i}`).value) || s.standardMax
  }));

  state.settings.steps = steps;
  saveTeamSettings(state.team, state.settings);

  // Show success
  const btn = event.target;
  const orig = btn.textContent;
  btn.textContent = 'âœ… SAVED!';
  setTimeout(() => btn.textContent = orig, 2000);
}

function savePIN() {
  const newPin = document.getElementById('new-pin').value;
  const confirmPin = document.getElementById('confirm-pin').value;

  if (newPin.length !== 4 || isNaN(newPin)) {
    alert('PIN must be exactly 4 digits.'); return;
  }
  if (newPin !== confirmPin) {
    alert('PINs do not match.'); return;
  }

  state.settings.pin = newPin;
  saveTeamSettings(state.team, state.settings);
  alert('âœ… PIN updated!');
  document.getElementById('new-pin').value = '';
  document.getElementById('confirm-pin').value = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MANAGER: DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadManagerDashboard() {
  const team = state.team;
  const grid = document.getElementById('manager-grid');

  // Find all submissions for this team
  let submissions = [];

  try {
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      if (key && key.startsWith(`ot_${team}_midweek_`)) {
        const data = loadFromStorage(key);
        if (data) submissions.push(data);
      }
    }
  } catch(e) {}

  document.getElementById('mg-total-fundraisers').textContent = submissions.length;

  if (submissions.length === 0) {
    grid.innerHTML = '<div class="alert alert-info">No mid-week data submitted yet.</div>';
    document.getElementById('mg-avg-we-pace').textContent = 'â€“';
    document.getElementById('mg-avg-sales-pace').textContent = 'â€“';
    return;
  }

  // Calculate averages
  let totalWe = 0, totalSales = 0, count = 0;
  submissions.forEach(s => {
    if (s.midweek && s.midweek.wePace) { totalWe += s.midweek.wePace; count++; }
    if (s.midweek && s.midweek.salesPace) totalSales += s.midweek.salesPace;
  });

  const avgWe = count > 0 ? Math.round(totalWe / count) : 0;
  const avgSales = count > 0 ? Math.round(totalSales / count) : 0;
  document.getElementById('mg-avg-we-pace').textContent = `${avgWe}%`;
  document.getElementById('mg-avg-sales-pace').textContent = `${avgSales}%`;

  // Build cards
  grid.innerHTML = submissions.map(s => {
    const mw = s.midweek || {};
    const g = s.goals || {};
    // Recalculate pace correctly from raw numbers
    const daysDone = mw.daysDone || 0;
    const interactions = mw.interactions || 0;
    const signups = mw.signups || 0;
    const goalInteractions = g.interactions || 0;
    const goalDays = g.days || 5;
    const goalProjected = g.projected || 0;

    const expectedSoFar = goalInteractions * daysDone;
    // MID-WEEK PACE: actual vs expected by this point in the week
    const wePace = expectedSoFar > 0 ? Math.round((interactions / expectedSoFar) * 100) : 0;
    const projectedFinal = daysDone > 0 ? (signups / daysDone) * goalDays : 0;
    const salesPace = goalProjected > 0 ? Math.round((projectedFinal / goalProjected) * 100) : 0;

    const wePaceClass = wePace >= 90 ? 'pace-good' : wePace >= 70 ? 'pace-warn' : 'pace-bad';
    const salesPaceClass = salesPace >= 90 ? 'pace-good' : salesPace >= 70 ? 'pace-warn' : 'pace-bad';

    return `
      <div class="fundraiser-card">
        <div class="name">${s.name}</div>
        <div class="stat">Week: <strong>${s.weekStart || 'â€“'}</strong></div>
        <div class="stat">Interactions: <strong>${interactions}</strong></div>
        <div class="stat">Sign-ups: <strong>${signups}</strong></div>
        <div class="stat">WE Pace: <strong class="${wePaceClass}">${wePace}%</strong></div>
        <div class="stat">Sales Pace: <strong class="${salesPaceClass}">${salesPace}%</strong></div>
        <div class="stat" style="font-size:11px;color:var(--muted);margin-top:6px">${mw.goingWell ? 'ğŸ’¬ ' + mw.goingWell.substring(0,40) + '...' : ''}</div>
      </div>
    `;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MANAGER TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function mgTab(name) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(`tab-${name}`).classList.add('active');

  if (name === 'dashboard') loadManagerDashboard();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function formatDate(dateStr) {
  if (!dateStr) return '';
  const d = new Date(dateStr + 'T00:00:00');
  return d.toLocaleDateString('en-AU', { day: 'numeric', month: 'short', year: 'numeric' });
}

// Set default week start to next Monday
(function setDefaultWeek() {
  const today = new Date();
  const day = today.getDay();
  const diff = day === 0 ? 1 : 8 - day;
  const nextMon = new Date(today);
  nextMon.setDate(today.getDate() + (day === 1 ? 0 : diff));
  document.getElementById('fr-week').valueAsDate = nextMon;
})();
</script>
